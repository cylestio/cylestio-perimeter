# Agent Inspector - AI Agent Security Analysis

## MCP Server
Connect to: `http://localhost:8080/mcp`

## Installation
```bash
pip install cylestio-gateway
agent-inspector anthropic --use-local-storage
```

## MCP Tools (14)

**Setup:** `get_workflow_config`
**Discovery:** `get_agents` (filter: workflow_id or "unlinked")
**Lifecycle:** `get_workflow_state`, `get_workflow_correlation`, `get_tool_usage_summary`, `update_agent_info`
**Analysis:** `get_security_patterns`, `create_analysis_session`, `store_finding`, `complete_analysis_session`, `get_findings`
**Knowledge:** `get_owasp_control`, `get_fix_template`
**Fix:** `update_finding_status`

## AUTOMATIC WORKFLOW

### 1. Setup
```
get_workflow_config() → auto-create cylestio.yaml if missing
```

### 2. Discover & Link
```
get_workflow_state(workflow_id)
get_agents("unlinked") → link any unlinked agents
update_agent_info(agent_id, workflow_id="xxx")
```

### 3. Based on State

| State | Action |
|-------|--------|
| NO_DATA | Static analysis |
| STATIC_ONLY | Tell user to run agent through proxy |
| DYNAMIC_ONLY | Static analysis → correlate |
| COMPLETE | Correlate + report |

### 4. Static Analysis
```
get_security_patterns()
create_analysis_session(workflow_id, "STATIC")
store_finding(...)
complete_analysis_session(session_id)
```

### 5. Correlate (when both exist)
```
get_workflow_correlation(workflow_id)
get_tool_usage_summary(workflow_id)
```

### 6. Name Agents
```
update_agent_info(agent_id, display_name="...", description="...")
```

## Agent Code Setup
```python
client = OpenAI(base_url="http://localhost:3000/workflow/{workflow_id}")
```

## Key Rules
- **Auto-create** cylestio.yaml
- **Auto-link** unlinked agents
- **Auto-correlate** when both data types exist
- **Never hardcode** patterns - fetch from MCP
